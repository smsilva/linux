#!/bin/bash
export IMAGE_NAME_EXPRESSION=$(
  tr "\n" "|" <<EOF | sed 's/|$//'
k3d
k3s
mongo
mysql
openjdk
pgadmin
postgres
EOF
)

docker images \
| egrep -v "${IMAGE_NAME_EXPRESSION?}" \
| sed 1d \
| awk '{ print $3 }' \
| while read -r DOCKER_IMAGE_ID; do
  if [ -n "${DOCKER_IMAGE_ID}" ]; then
    docker rmi -f "${DOCKER_IMAGE_ID?}" &> /dev/null
  fi
done

docker system prune -f &> /dev/null

docker volume ls \
| sed 1d \
| awk '{ print $2 }' \
| xargs -I {} docker volume rm {} &> /dev/null

docker images
