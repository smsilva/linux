#!/bin/bash
ARM_SAS_TOKEN_FILE="${HOME}/.credentials/azure/${ARM_STORAGE_ACCOUNT_NAME}.sas-token"
ARM_SAS_TOKEN_FILE_INFORMATION=""
ARM_SAS_TOKEN_INFORMATION=""

if [ -e "${ARM_SAS_TOKEN_FILE}" ]; then
  ARM_SAS_TOKEN_FILE_INFORMATION_DATE=$(stat -c "%y" "${ARM_SAS_TOKEN_FILE}")
  ARM_SAS_TOKEN_FILE_INFORMATION_DATE_TIME=$(     echo ${ARM_SAS_TOKEN_FILE_INFORMATION_DATE} | awk -F '.' '{ print $1 }')
  ARM_SAS_TOKEN_FILE_INFORMATION_DATE_TIMEZONE=$( echo ${ARM_SAS_TOKEN_FILE_INFORMATION_DATE} | awk -F ' ' '{ print $3 }' | tr -d " ")
  ARM_SAS_TOKEN_FILE_INFORMATION="${ARM_SAS_TOKEN_FILE_INFORMATION_DATE_TIME} ${ARM_SAS_TOKEN_FILE_INFORMATION_DATE_TIMEZONE}"
fi

if [ -n "${ARM_SAS_TOKEN}" ]; then
  ARM_SAS_TOKEN_INFORMATION="$(echo "${ARM_SAS_TOKEN:0:16}" | tr -d "\"se=" | tr "T" " "):00"
fi

echo "ARM_TENANT_ID......................: ${ARM_TENANT_ID}"
echo "ARM_SUBSCRIPTION_NAME..............: ${ARM_SUBSCRIPTION_NAME}"
echo "ARM_SUBSCRIPTION_ID................: ${ARM_SUBSCRIPTION_ID}"
echo "ARM_CLIENT_ID......................: ${ARM_CLIENT_ID}"
echo "ARM_CLIENT_SECRET..................: ${ARM_CLIENT_SECRET:0:3}"
echo "ARM_STORAGE_ACCOUNT_NAME...........: ${ARM_STORAGE_ACCOUNT_NAME}"
echo "ARM_STORAGE_ACCOUNT_CONTAINER_NAME.: ${ARM_STORAGE_ACCOUNT_CONTAINER_NAME}"
echo "ARM_SAS_TOKEN_FILE_CREATION........: ${ARM_SAS_TOKEN_FILE_INFORMATION}"
echo "ARM_SAS_TOKEN_EXPIRATION...........: ${ARM_SAS_TOKEN_INFORMATION}"

if [ -n "${ARM_ACCESS_KEY}" ]; then
  echo "ARM_ACCESS_KEY.....................: ${ARM_ACCESS_KEY:0:3}"
fi
