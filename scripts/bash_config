export PATH=${HOME}/bin-${USER}:${PATH}
export PATH=${PATH}:${HOME}/bin/go/bin
export PATH=${PATH}:${HOME}/git/terraform-packager/scripts
export PATH=${PATH}:${HOME}/istio-1.11.2/bin
export PATH=${PATH}:${HOME}/bin/apache-maven/bin

if which today-fortune &> /dev/null; then
  today-fortune
fi

if [ -f /usr/share/powerline/bindings/bash/powerline.sh ]; then
  powerline-daemon -q
  POWERLINE_BASH_CONTINUATION=1
  POWERLINE_BASH_SELECT=1
  source /usr/share/powerline/bindings/bash/powerline.sh
fi

if [ -f ~/.fzf.bash ]; then
  export FZF_DEFAULT_COMMAND="fdfind --type f --follow --exclude .git"
  export FZF_CTRL_T_COMMAND="fdfind --type f --follow --exclude .git"
  export FZF_DEFAULT_OPTS="--height 40% --layout=reverse --border"
  source ~/.fzf.bash
fi

export CREDENTIALS_DIRECTORY="${HOME}/.credentials"

mkdir -p "${CREDENTIALS_DIRECTORY}/azure"

if [ -e "${CREDENTIALS_DIRECTORY}/azure/current" ]; then
  if [ ! -e "${CREDENTIALS_DIRECTORY}/bash_azure" ]; then
    ln -s "${CREDENTIALS_DIRECTORY}/azure/current" "${CREDENTIALS_DIRECTORY}/bash_azure"
  fi
fi

if [ -n "${CREDENTIALS_DIRECTORY}" ]; then
  while read -r BASH_FILE; do
    if [ -n "${BASH_FILE}" ]; then
      source "${BASH_FILE}"
    fi
  done <<< "$(find -L "${CREDENTIALS_DIRECTORY}" -maxdepth 1 -type f | sort)"

  ARM_SAS_TOKEN_FILE=$(arm_sas_token_file)

  if [ -f "${ARM_SAS_TOKEN_FILE}" ]; then
    source "${ARM_SAS_TOKEN_FILE}"
  fi
fi

if which kubectl &> /dev/null; then
  export KUBE_EDITOR='code --wait'
  
  source <(kubectl completion bash)
  complete -F __start_kubectl k
fi

#echo "SHLVL=${SHLVL}"
#echo ${PATH} | tr ":" "\n" | sort

export CHECKOV_VERSION=2.0.708
# export CHECKOV_VERSION=2.0.1190
